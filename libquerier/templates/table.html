{% extends "base.html" %}

{% block main %}

<div>
    <div class="flex flex-row flex-wrap py-4">
        <aside class="w-full sm:w-1/2 md:w-1/3 xl:w-1/4 px-2">
          
          <h3 class="ml-4 mb-2"><strong>Tables</strong></h3>
          <hr>
          {% for schema in schemas %}
            <details class="collapse collapse-arrow">
              <summary class="collapse-title pt-0 pb-1 min-h-0">{{ schema.name }}</summary>
              <div class="collapse-content">
                <ul>
                  {% for type, field in schema.fields %}
                    <li class="text-xs">{{ field }} <small>({{type}})</small></li>
                  {% endfor %}
                </ul>
              </div>
            </details>
          {% endfor %}
        </aside>

        <main id="main" role="main" class="w-full sm:w-1/2 md:w-2/3 xl:w-3/4 pt-1 px-2">
          <div>
            <form hx-target="#results" hx-params="sql" hx-get="/" hx-select="#results" hx-swap="outerHTML" hx-push-url="true" hx-indicator="#results-spinner">
              <textarea class="w-full h-32 p-2 border border-slate-300 rounded-md" placeholder="Enter your sql" id="sql" name="sql">{{ sql }}</textarea>
              <button class="btn btn-primary btn-sm btn-active" type="submit">Run</button>
              <span id="results-spinner" class="relative top-2 htmx-indicator loading loading-spinner loading-md"></span>
            </form>
          </div>

          <div id="results" class="mt-2">
          {% if error %}
            {{ error }}
          {% else %}
            <a class="btn btn-sm" href="/results.csv?sql={{sql|urlencode}}">Download as CSV</a>
            <a class="btn btn-sm" href="/results.json?sql={{sql|urlencode}}">JSONL Stream</a>
            <table class="table table-xs table-pin-rows mt-2">
              <thead>
                <tr>
                  {% for header in headers %}
                    <th>{{ header }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for row in rows %}
                <tr>
                  {% for cell in row %}
                  <td class="border border-slate-300 p-1">{{cell}}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          {% endif %}
          </div>
        </main>
    </div>
</div>




{% endblock main %}
